<template>
  <div class="dh-sign-app">
    <div class="dh-sign-step" :class="[`dh-step-${ wizardState }`]">
      <a class="dh-logo" href="/">
        <svg width="200" height="36" viewBox="0 0 200 36" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g clip-path="url(#clip0)">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M67.9411 25.2727V10.4043H65.6729V17.7513H65.6221C65.053 16.7596 63.7639 15.8697 61.8533 15.8697C58.8078 15.8697 56.2264 18.3844 56.2526 22.477C56.2526 26.2126 58.5749 28.7289 61.5942 28.7289C63.6327 28.7289 65.1547 27.6872 65.8517 26.3144H65.9025L66.0058 28.4495H68.0444C67.9673 27.6113 67.9411 26.3661 67.9411 25.2727ZM65.5663 20.2143C65.6434 20.4937 65.6696 20.8748 65.6696 21.1542H65.668V23.291C65.668 23.6463 65.6418 23.9515 65.5647 24.2568C65.1514 25.9332 63.759 26.9249 62.2354 26.9249C59.7836 26.9249 58.5454 24.8657 58.5454 22.3752C58.5454 19.6554 59.9394 17.6221 62.2879 17.6221C63.9919 17.6221 65.2301 18.7914 65.5663 20.2143ZM73.4384 14.0641C74.3421 14.0641 74.9095 13.4536 74.8833 12.6913C74.8833 11.9031 74.3404 11.2926 73.4909 11.2926C72.6643 11.2926 72.0706 11.9031 72.0706 12.6913C72.0706 13.4536 72.6381 14.0641 73.4384 14.0641ZM72.3543 16.1475V28.4479H74.6258V16.1475H72.3543ZM79.0373 19.9849C79.0373 18.5362 79.0111 17.2909 78.934 16.1475H80.9217L80.9988 18.562H81.1021C81.6696 16.9098 83.0374 15.8681 84.561 15.8681C84.8184 15.8681 85.0005 15.8939 85.2055 15.944V18.0533C84.9726 18.0032 84.7414 17.9774 84.4314 17.9774C82.8307 17.9774 81.6958 19.1725 81.3859 20.849C81.335 21.1542 81.2825 21.5095 81.2825 21.8907V28.4479H79.0373V19.9849ZM93.4122 26.9749C91.1407 26.9749 89.1793 25.7297 89.1284 22.7047H97.9025C97.9066 22.667 97.9114 22.6258 97.9166 22.5812C97.943 22.3562 97.9796 22.0444 97.9796 21.663C97.9796 19.4002 96.8955 15.8681 92.8185 15.8681C89.1793 15.8681 86.9603 18.7897 86.9603 22.5012C86.9603 26.2126 89.2564 28.7031 93.1022 28.7031C95.0899 28.7031 96.4577 28.2961 97.258 27.9407L96.8709 26.3402C96.0181 26.6955 95.0374 26.9749 93.4122 26.9749ZM92.6381 17.4702C95.1932 17.4702 95.8131 19.6813 95.7869 21.1041H89.1547C89.3351 19.5537 90.3404 17.4702 92.6381 17.4702ZM110.344 27.9905C109.75 28.2958 108.433 28.7028 106.757 28.7028C102.99 28.7028 100.538 26.1865 100.538 22.425C100.538 18.6376 103.17 15.8936 107.247 15.8936C108.589 15.8936 109.776 16.2247 110.396 16.5284L109.88 18.2565C109.338 17.9512 108.486 17.6718 107.247 17.6718C104.382 17.6718 102.834 19.7553 102.834 22.3232C102.834 25.169 104.692 26.923 107.17 26.923C108.461 26.923 109.312 26.5919 109.958 26.3125L110.344 27.9905ZM116.718 16.1469V12.6147L114.501 13.1994V16.1469H112.566V17.8508H114.501V24.5598C114.501 26.0086 114.734 27.102 115.379 27.7625C115.92 28.373 116.773 28.7025 117.83 28.7025C118.708 28.7025 119.403 28.5749 119.843 28.3973L119.739 26.7192C119.454 26.7951 119.016 26.871 118.422 26.871C117.156 26.871 116.718 26.0069 116.718 24.4823V17.8492H119.971V16.1469H116.718ZM126.937 10.4043H129.209V18.0791H129.26C129.62 17.4444 130.189 16.884 130.885 16.5028C131.556 16.1217 132.356 15.8681 133.207 15.8681C134.885 15.8681 137.568 16.884 137.568 21.1284V28.4479H135.296V21.3836C135.296 19.4019 134.549 17.7238 132.407 17.7238C130.936 17.7238 129.775 18.7397 129.361 19.9607C129.232 20.2659 129.207 20.5954 129.207 21.0283V28.4495H126.937V10.4043ZM147.454 26.9749C145.183 26.9749 143.221 25.7297 143.17 22.7047H151.946L151.957 22.6126L151.957 22.6124L151.957 22.6123L151.957 22.6121L151.957 22.6119C151.984 22.3849 152.023 22.0621 152.023 21.663C152.023 19.4002 150.939 15.8681 146.862 15.8681C143.223 15.8681 141.004 18.7897 141.004 22.5012C141.004 26.2126 143.3 28.7031 147.146 28.7031C149.132 28.7031 150.499 28.2961 151.3 27.9407L150.913 26.3402C150.06 26.6955 149.079 26.9749 147.454 26.9749ZM146.68 17.4702C149.235 17.4702 149.855 19.6813 149.829 21.1041H143.196C143.377 19.5537 144.384 17.4702 146.68 17.4702ZM155.482 19.9849C155.482 18.5362 155.456 17.2909 155.379 16.1475H157.366L157.443 18.562H157.547C158.114 16.9098 159.482 15.8681 161.006 15.8681C161.263 15.8681 161.445 15.8939 161.65 15.944V18.0533C161.417 18.0032 161.186 17.9774 160.876 17.9774C159.275 17.9774 158.14 19.1725 157.83 20.849C157.78 21.1542 157.727 21.5095 157.727 21.8907V28.4479H155.482V19.9849ZM169.392 28.7273C172.412 28.7273 175.611 26.7456 175.611 22.1959C175.611 18.4344 173.186 15.8681 169.599 15.8681C166.14 15.8681 163.405 18.2826 163.405 22.3994C163.405 26.2869 166.012 28.7273 169.392 28.7273ZM169.494 27.0508C167.275 27.0508 165.701 25.0175 165.701 22.3235C165.701 19.9849 166.864 17.5461 169.545 17.5461C172.23 17.5461 173.287 20.19 173.287 22.2734C173.287 25.0433 171.662 27.0508 169.494 27.0508ZM180.387 22.7047C180.438 25.7297 182.399 26.9749 184.671 26.9749C186.296 26.9749 187.277 26.6955 188.13 26.3402L188.517 27.9407C187.716 28.2961 186.349 28.7031 184.363 28.7031C180.517 28.7031 178.221 26.2126 178.221 22.5012C178.221 18.7897 180.44 15.8681 184.079 15.8681C188.156 15.8681 189.24 19.4002 189.24 21.663C189.24 22.0621 189.201 22.3848 189.174 22.6119L189.174 22.6124L189.163 22.7047H180.387ZM187.046 21.1041C187.072 19.6813 186.452 17.4702 183.897 17.4702C181.601 17.4702 180.594 19.5537 180.413 21.1041H187.046ZM195.38 27.0504C194.245 27.0504 193.058 26.5934 192.387 26.1605L191.821 27.8628C192.699 28.3716 193.963 28.7011 195.331 28.7011C198.298 28.7011 200.002 27.1764 200.002 25.0155C200.002 23.1856 198.891 22.118 196.723 21.304C195.096 20.6951 194.349 20.2364 194.349 19.2206C194.349 18.3048 195.098 17.5425 196.44 17.5425C197.601 17.5425 198.504 17.9495 198.995 18.2547L199.562 16.6284C198.865 16.2214 197.755 15.8661 196.49 15.8661C193.806 15.8661 192.181 17.494 192.181 19.4757C192.181 20.9503 193.238 22.1697 195.484 22.9578C197.161 23.5683 197.806 24.153 197.806 25.2206C197.806 26.2364 197.032 27.0504 195.38 27.0504Z" fill="url(#paint0_linear)"/>
          <path d="M16.641 35.9998C16.5639 35.9998 16.4868 35.9901 16.413 35.9691C16.1129 35.8884 15.8816 35.6477 15.775 35.3085L10.545 21.1169C10.5188 21.0345 10.5319 20.8536 10.5664 20.6291L10.3154 20.6856L10.8288 19.3823C10.8386 19.3403 10.8484 19.3015 10.8566 19.2676C11.2765 17.5912 11.5012 17.4393 11.6094 17.3683C11.757 17.2698 11.939 17.2762 12.0735 17.3828L12.2605 17.5314L11.452 19.5842C11.4356 19.6488 11.4208 19.7134 11.406 19.7764L18.7779 18.1048L15.8964 16.5204L28.2326 11.7898L26.0136 10.4412L50.4056 2.91174L47.5257 5.88994L46.3728 6.39061L39.3535 9.94701L40.126 10.8821L42.1104 11.4248L31.8619 15.8824L32.39 15.9939L35.5093 17.0178L35.2945 17.6655L36.6065 18.0805L36.2687 18.2356L36.39 18.234L20.2424 25.6455C20.3753 25.7005 20.5262 25.7554 20.6393 25.7974C20.8476 25.8749 21.0624 25.954 21.2314 26.0348L24.1178 27.5626C24.2851 27.6434 24.5426 27.6854 24.7689 27.7225C25.133 27.7823 25.4495 27.834 25.5348 28.1215C25.5872 28.2975 25.5184 28.4703 25.3314 28.6383L17.4183 35.6687C17.1773 35.8851 16.9034 35.9998 16.641 35.9998ZM11.1797 20.9457L16.3966 35.105C16.4245 35.1923 16.4786 35.3182 16.5868 35.3473C16.6918 35.3764 16.8394 35.3166 16.9804 35.1906L24.6656 28.3621H24.6623C24.4048 28.3201 24.0834 28.2668 23.8193 28.1392L20.9329 26.6114C20.8033 26.55 20.6032 26.4757 20.4097 26.403C19.798 26.1769 19.3568 26.0138 19.3421 25.6472C19.3372 25.5373 19.3765 25.3322 19.6816 25.1917L33.3708 18.9091L33.2478 18.9107L34.814 18.192L34.4663 18.0821L34.6828 17.428L32.1998 16.6124L29.7348 16.1004L40.1686 11.5637L39.7504 11.449L38.3351 9.73705L46.0989 5.80273L47.1403 5.35051L48.1801 4.27487L27.5815 10.635L29.6971 11.9222L17.4315 16.6253L20.5836 18.3583L11.2552 20.4741C11.2125 20.6873 11.1863 20.8568 11.1797 20.9457Z" fill="url(#paint1_linear)"/>
          <path d="M28.9165 15.9636V20.4019L34.6123 17.7596L28.9165 15.9636Z" fill="url(#paint2_linear)"/>
          <path d="M28.9165 15.9636V20.4019L34.6123 17.7596L28.9165 15.9636Z" fill="#1B1E24" fill-opacity="0.45"/>
          <path d="M36.6411 10.2494V13.8785L41.1348 11.4801L36.6411 10.2494Z" fill="url(#paint3_linear)"/>
          <path d="M36.6411 10.2494V13.8785L41.1348 11.4801L36.6411 10.2494Z" fill="#1B1E24" fill-opacity="0.45"/>
          <path d="M52.8461 0.0662188L0.504931 16.0361C-0.126475 16.2283 -0.172395 16.6159 0.40489 16.8953L11.3044 22.2412L21.8235 17.845L17.689 16.4915L31.0109 11.5801L27.6078 10.6466L47.8998 4.72409L36.6443 10.2347L39.9375 11.1359L28.933 15.9618L34.3417 17.6738L17.894 25.3841C18.4729 25.6619 25.2692 28.905 25.8465 29.1844L33.671 32.9507C34.2499 33.2285 34.9502 33.059 35.229 32.5712L53.4906 0.600808C53.7677 0.114671 53.4791 -0.125975 52.8461 0.0662188Z" fill="url(#paint4_linear)"/>
          <path d="M17.8972 25.386L16.7475 34.9198L16.6655 35.6482C16.6655 35.6482 16.9279 35.6643 17.2658 35.3445L17.5577 35.0845L24.7754 28.6791L18.896 25.8447" fill="url(#paint5_linear)"/>
          <path d="M17.8972 25.386L16.7475 34.9198L16.6655 35.6482C16.6655 35.6482 16.9279 35.6643 17.2658 35.3445L17.5577 35.0845L24.7754 28.6791L18.896 25.8447" fill="#1B1E24" fill-opacity="0.45"/>
          </g>
          <defs>
          <linearGradient id="paint0_linear" x1="56.2519" y1="19.5669" x2="200.002" y2="19.5669" gradientUnits="userSpaceOnUse">
          <stop offset="0.6016" stop-color="#661ACE"/>
          <stop offset="1" stop-color="#2665F9"/>
          </linearGradient>
          <linearGradient id="paint1_linear" x1="10.3153" y1="19.4563" x2="50.4055" y2="19.4563" gradientUnits="userSpaceOnUse">
          <stop offset="0.6016" stop-color="#661ACE"/>
          <stop offset="1" stop-color="#2665F9"/>
          </linearGradient>
          <linearGradient id="paint2_linear" x1="28.9173" y1="18.1826" x2="34.6128" y2="18.1826" gradientUnits="userSpaceOnUse">
          <stop offset="0.6016" stop-color="#661ACE"/>
          <stop offset="1" stop-color="#4E5BA8"/>
          </linearGradient>
          <linearGradient id="paint3_linear" x1="36.6408" y1="12.0641" x2="41.1342" y2="12.0641" gradientUnits="userSpaceOnUse">
          <stop stop-color="#661ACE"/>
          <stop offset="0.0662" stop-color="#631DD0"/>
          <stop offset="1" stop-color="#2665F9"/>
          </linearGradient>
          <linearGradient id="paint4_linear" x1="-0.000193591" y1="16.5427" x2="53.5959" y2="16.5427" gradientUnits="userSpaceOnUse">
          <stop offset="0.6016" stop-color="#661ACE"/>
          <stop offset="1" stop-color="#2665F9"/>
          </linearGradient>
          <linearGradient id="paint5_linear" x1="16.6645" y1="30.5167" x2="24.7735" y2="30.5167" gradientUnits="userSpaceOnUse">
          <stop offset="0.6016" stop-color="#661ACE"/>
          <stop offset="1" stop-color="#4E3F8F"/>
          </linearGradient>
          <clipPath id="clip0">
          <path d="M0 0H200V36H0V0Z" fill="white"/>
          </clipPath>
          </defs>
        </svg>
      </a>
      <component
        :is="wizardState"
      ></component>
    </div>
  </div>
</template>

<script>
import wizardMixin from '../mixins/wizard/wizard'
import signUp from './wizard/sign-up'
import billing from './wizard/billing'
import thanks from './wizard/thanks'
import plans from './wizard/plans'

export default {
  data() {
    const code = /code=([^&]*)/.exec(location.search);
    const { defaultPlan, plans } = dh;
    const currentPlan = (code && code[1]) || defaultPlan;

    plans.forEach(element => element.parameters.sort((a,b) => a.priority - b.priority));

    return {
      selectedPlan: plans.find(plan => plan.code === currentPlan) || plans[0],
      dhAccount: null,
    }
  },

  mixins: [ wizardMixin ],

  components: {
    signUp,
    billing,
    thanks,
    plans,
  },

  created() {
    const { setWizardState, sendAnalyticEvent, selectedPlan } = this;
    const referrer = /ref=([^&]*)/.exec(location.search);

    sendAnalyticEvent('InitiateCheckout', {
      value: selectedPlan.price,
      currency: 'USD',
      plan: selectedPlan.code,
    });

    if (referrer && referrer[1]) {
      document.cookie = 'referrer=' + referrer[1] + '; path=/; max-age=2592000'
    }

    setWizardState(null, 'sign-up');
  },
}
</script>

<style lang="scss">
@import '../styles/fonts.scss';
@import '../styles/index.scss';

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  height: 100vh;
  background-color: $mainBGColor;
  font: normal 14px Rubik, sans-serif;
  color: $mainTextColor;
}

.dh-sign-app {
  min-height: 100%;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;

  a {
    text-decoration: none;
    color: $primary;
  }

  .dh-sign-step {
    background: #FFFFFF;
    box-shadow: 0px 2px 80px rgba(27, 30, 36, 0.05);
    border-radius: 4px;
    padding-top: 40px;
    position: relative;
    margin: 100px 0 25px;
  }

  .dh-sign-title {
    font-size: 30px;
    line-height: 36px;
    text-align: center;
    color: #000000;
  }

  .dh-logo {
    width: 200px;
    height: 36px;
    // background-image: url(../assets/logo.png);
    // background-position: center;
    // background-size: cover;
    // background-repeat: no-repeat;
    margin: 0 auto;
    position: absolute;
    bottom: calc(100% + 40px);
    left: calc(50% - 100px);
  }

  @include  screen-xs {
    .dh-sign-step {
      width: calc(100% - 32px);
      padding: 28px 16px 0;
    }

    .dh-sign-title {
      font-size: 20px;
      line-height: 24px;
    }

    .dh-logo {
      bottom: calc(100% + 25px);
    }
  }
}
</style>