<template>
  <div class="rule-container">
    <div :class="[{'rule-item': true}, `rule-type-${ rule.type }`]" v-for="rule in rules" :key="rule.id">
      <div class="rule-title">
        <div class="rule-icon">
          <svg  width="13px" height="11px" viewBox="0 0 13 11" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6.50338 0C2.90959 0 0 2.37531 0 5.30406C0 6.35938 0.379364 7.3425 1.0297 8.1675C1.06019 8.19844 1.12793 8.29813 1.15164 8.33594C1.15164 8.33594 1.11777 8.28094 1.11438 8.27063C1.19229 8.38406 1.23632 8.51469 1.23632 8.65563C1.23632 8.70375 0.630015 10.6494 0.630015 10.6494C0.585982 10.8006 0.701146 10.9553 0.887441 10.9931C0.914538 11 0.941635 11 0.968733 11C1.01277 11 1.05341 10.9931 1.09406 10.9828L1.14825 10.9622L2.86217 10.2059C2.89265 10.1922 3.16701 10.0856 3.20088 10.0719L3.22121 10.065C3.22121 10.065 3.21782 10.065 3.20088 10.0719C3.31605 10.0306 3.44476 10.01 3.58025 10.01C3.70219 10.01 3.82074 10.0272 3.92913 10.0616C3.93251 10.0616 3.9359 10.0616 3.9359 10.065C3.95284 10.0719 3.96977 10.0753 3.98671 10.0822C4.76915 10.3538 5.6261 10.4362 6.53048 10.4362C10.1209 10.4362 13 8.23281 13 5.30406C13.0068 2.37531 10.0938 0 6.50338 0Z" fill="white"/>
          </svg>
        </div>
        {{ruleTitles[rule.type]}}
      </div>
      <template v-if="rule.type === 'list'">
        <template>
          <keywords
            v-for="element in rule.elements"
            v-model="element.condition.value"
            :key="element.id"
            >
          </keywords>
        </template>
      </template>
    </div>
  </div>
</template>

<script>
import keywords from "../keywords.vue";

export default {
  // data() {
  //   return {
  //     elementTitles: {
  //       list: ''
  //     }
  //   }
  // },

  props: ['elements'],

  components: {
    keywords
  },

  computed: {
    rules() {
      const { elements } = this;
      const rules = []
      const listRules = []

      elements.forEach((element, index) => {
        const rule = { element };

        if (element.type !== 'rule') return;

        const { value, entity, operand } = element.condition;

        switch(value) {
          case 'postReply':
            rule.post = elements[elements.indexOf(element) + 1]
          case 'adReply':
          case 'storyReply':
            rule.id = element.id;
            rule.type = value;
            rules.push(rule)
          break;
          default:
            if (entity !== 'message' || operand !== 'contains') return;

            if (!listRules.length) {
              rules.push({type: 'list', elements: listRules, id: element.id })
            }

            listRules.push(element)
          break
        }
      });

      return rules
    },

    ruleTitles() {
      return {
        list: 'List',
        postReply: 'Post Reply',
        adReply: 'Ad Reply',
        storyReply: 'Story Reply',
      }
    }
  }
}
</script>

<style lang="scss">
.rule-container {

}

.rule-item {
  .rule-title {
    background-color: #C34794;
    padding: 7px 14px;
    color: #FFF;
    border: none;
    height: auto;
    line-height: normal;
    border-radius: 18px;
    display: flex;
    align-items: center;
  }

  .rule-icon {
    margin-right: 10px;
  }

  .keywords {
    margin-top: 10px;
  }
}
</style>
